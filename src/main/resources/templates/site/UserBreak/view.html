<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout/basic_layout.html}">

<head>
    <title>휴가 신청 - 상세보기</title>
    <th:block layout:fragment="script">
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", () => {
                setDefault();
                registEvent();
            });

            const csrf = { 'header' : null, 'value' : null };

            const button = { 'list' : null};

            const setDefault = function() {
                csrf.header = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
                csrf.token = document.querySelector('meta[name="_csrf"]').getAttribute('content');

                button.list = document.querySelector('.btn-view');
                // button.modify = document.querySelector('.btn-regist');
            };

            const registEvent = function() {
                let searchData = new FormData(document.querySelector('[name="searchForm"]'));
                /**
                 button.list.addEventListener('click', () => {
                 window.location.replace('/mngr/gov/policy/list?' + getQueryStr(searchData));
                 });
                 **/
                button.list.addEventListener('click', () => {
                    window.location.replace('/site/UserBreak/list?' + getQueryStr(searchData));
                });

                /**
                button.modify.addEventListener('click', () => {
                    let id = document.querySelector('input[name="empId"]').value;
                    window.location.replace('/mngr/Employee/modify?&empId='+ id +'&'+ getQueryStr(searchData));
                    //http://localhost:8892/mngr/gov/policy/modify?&govId=79
                });
                 **/

                // 삭제
                button.del = document.querySelectorAll('.bttn-del');
                for(del of button.del) {
                    del.addEventListener('click', delt);
                }
            };

            async function delt(e) {
                let searchData = new FormData(document.querySelector('[name="searchForm"]'));
                console.log(searchData);

                const holidayId = document.querySelector('[name="holidayId"]').value;

                const formData = {
                    searchData: searchData,
                    holidayId: holidayId
                };

                await fetch('/delete', {
                    method : 'POST',
                    headers : {'Content-Type' : 'application/json', 'X-CSRF-TOKEN' :  csrf.token },
                    body : JSON.stringify(formData),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if(data.result) {
                            alert('삭제 성공');
                            window.location.replace('/site/UserBreak/list?' + getQueryStr(searchData));
                        } else {
                            alert('게시물을 삭제하는데 실패하였습니다.');
                        }
                    })
                    .catch((error) => {
                        alert('데이터를 가져오는데 실패하였습니다.');
                        console.log(error);
                    });
            };








        </script>
    </th:block>
</head>

<body>
<th:block layout:fragment="content">
    <div style="display: flex;">
        <!--sidebar-->
        <th:block th:replace="~{site/fragment/basic_aside :: aside}"></th:block>


        <!--content-->
        <div class="content">
            <!--상단-->
            <th:block th:replace="~{site/fragment/basic_nav :: nav}"></th:block>
            <!--content-->
            <div class="content-box">
                <!--경로-->
                <div class="current-site-path">
                    <ul>
                        <li>
                            <span>
                                휴가 신청
                            </span>
                        </li>
                        <li>
                            <span>
                                상세보기
                            </span>
                        </li>
                    </ul>
                </div>

                <!-- 검색 form -->
                <form name="searchForm" method="post" onsubmit="return false;">
                    <!-- 검색 조건 -->
                    <input type="hidden" name="holidayId" th:value="${breakDTO.holidayId}">
                    <input type="hidden" name="empName" th:value="${breakDTO.empName}"> <!--이름-->
                    <input type="hidden" name="department" th:value="${breakDTO.department}"> <!--부서-->
                    <input type="hidden" name="position" th:value="${breakDTO.position}"> <!--직급-->
                    <input type="hidden" name="regDate" th:value="${breakDTO.regDate}"> <!--신청일-->
                    <input type="hidden" name="startDate" th:value="${breakDTO.startDate}"><!--휴가기간-->
                    <input type="hidden" name="endDate" th:value="${breakDTO.endDate}"><!--휴가기간-->
                    <input type="hidden" name="useDays" th:value="${breakDTO.useDays}"><!--신청일수-->
                    <input type="hidden" name="totalDays" th:value="${breakDTO.totalDays}"><!--부여받은 일수-->
                    <input type="hidden" name="rejectReason" th:value="${breakDTO.rejectReason}"><!--부여받은 일수-->
                    <input type="hidden" name="remainDays" th:value="${breakVO.remainDays}"><!--남은 일수-->

                    <!--페이지 네이션-->
                    <input type="hidden" name="pageNo" th:value="${breakDTO.pageNo}">
                    <input type="hidden" name="pageBlock" th:value="${breakDTO.pageBlock}">
                </form>

                <!--content-table-->
                <div class="view-table">
                    <table>
                        <colgroup>
                            <col width="12%">
                            <col>
                        </colgroup>
                        <tbody>
                        <tr>
                            <th>
                                이름
                            </th>
                            <td th:text="${breakVO.empName}"></td>
                        </tr>
                        <tr>
                            <th>
                                사번
                            </th>
                            <td th:text="${breakVO.empNo}"></td>
                        </tr>
                        <tr>
                            <th>
                                부서
                            </th>
                            <td th:text="${breakVO.department}"></td>
                        </tr>
                        <tr>
                            <th>
                                직급
                            </th>
                            <td th:text="${breakVO.position}"></td>
                        </tr>
                        <tr>
                            <th>
                                신청일
                            </th>
                            <td th:text="${breakVO.regDate}"></td>
                        </tr>
                        <tr>
                            <th>
                                휴가기간
                            </th>
                            <td>
                                <span th:text="${breakVO.startDate}"></span>
                                <span>~</span>
                                <span th:text="${breakVO.endDate}"></span>
                                <span th:text="${breakVO.useDays % 1 == 0} ? ${breakVO.useDays.intValue()} : ${breakVO.useDays}"></span>일
                            </td>
                        </tr>
                        <tr>
                            <th>
                                부여휴가일수
                            </th>
                            <td>
                                <span th:text="${breakVO.totalDays}"></span><span>일</span>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                잔여휴가일수
                            </th>
                            <td>
                                <span th:text="${breakVO.remainDays}"></span><span>일</span>
                            </td>
                        </tr>

                        <tr>
                            <th>
                                사유
                            </th>
                            <td th:text="${breakVO.reason}">
                            </td>
                        </tr>

                        <tr>
                            <th>
                                반려사유
                            </th>
                            <td th:text="${breakVO.rejectReason}">
                            </td>
                        </tr>




                        </tbody>
                    </table>

                </div>


                <!--버튼-->
                <div class="search-button">
                    <button type="button" class="btn bttn-del w75">삭제</button>
                    <button type="button" class="btn btn-view w75">목록</button>
                </div>










            </div>

        </div>








    </div>
</th:block>



</body>

</html>