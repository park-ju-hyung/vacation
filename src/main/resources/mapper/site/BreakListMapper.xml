<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.vacation.mvc.mapper.site.BreakListMapper">
	<!--리스트-->
	<sql id="basicTable">
		SELECT
			'break' AS src,
			empName,
			DATE_FORMAT(empBirth, '%Y-%m-%d') AS empBirth,
			empNo,
			position,
			department,
			DATE_FORMAT(startDate, '%Y-%m-%d') AS startDate,
			DATE_FORMAT(endDate,   '%Y-%m-%d') AS endDate,
			useDays,
			type,
			totalDays,
			reason,
			approval,
			status,
			regDate,
			rejectReason,
			vacationType
		FROM break
		WHERE empNo = #{empNo}
		UNION ALL
		SELECT
			'special' AS src
			empName,
			DATE_FORMAT(empBirth, '%Y-%m-%d') AS empBirth,
			empNo,
			position,
			department,
			DATE_FORMAT(startDate, '%Y-%m-%d') AS startDate,
			DATE_FORMAT(endDate,   '%Y-%m-%d') AS endDate,
			useDays,
			type,
			totalDays,
			reason,
			approval,
			status,
			regDate,
			rejectReason,
			vacationType,
			specialType
		FROM special_break
		WHERE empNo = #{empNo}
		UNION ALL
		SELECT
			'sick' AS src
			empName,
			DATE_FORMAT(empBirth, '%Y-%m-%d') AS empBirth,
			empNo,
			position,
			department,
			DATE_FORMAT(startDate, '%Y-%m-%d') AS startDate,
			DATE_FORMAT(endDate,   '%Y-%m-%d') AS endDate,
			useDays,
			type,
			totalDays,
			reason,
			approval,
			status,
			regDate,
			rejectReason,
			vacationType
		FROM sick_break
		WHERE empNo = #{empNo}
		ORDER BY regDate DESC;

	</sql>

	<sql id="where">
		WHERE 1=1
		<if test="schDtStart != '' and schDtStart != null">
			AND DATE_FORMAT(regDate, '%Y-%m-%d') <![CDATA[>=]]> #{schDtStart}
		</if>
		<if test="schDtEnd != '' and schDtEnd != null">
			AND DATE_FORMAT(regDate, '%Y-%m-%d') <![CDATA[<=]]> #{schDtEnd}
		</if>
		<if test="schDtStart2 != '' and schDtStart2 != null">
			AND DATE_FORMAT(startDate, '%Y-%m-%d') <![CDATA[>=]]> #{schDtStart}
		</if>
		<if test="schDtEnd2 != '' and schDtEnd2 != null">
			AND DATE_FORMAT(endDate, '%Y-%m-%d') <![CDATA[<=]]> #{schDtEnd}
		</if>
		<if test="vacationType != null and vacationType != ''">
			AND vacationType LIKE CONCAT('%', #{vacationType}, '%')
		</if>
	</sql>

	<select id="AllBreakCount" parameterType="com.example.vacation.mvc.dto.BreakListDTO" resultType="integer">
		SELECT count(*) FROM (
		SELECT 1
		FROM (
			<include refid="basicTable"/>
		) AS t
		<include refid="where"/>
	</select>

	<select id="AllBreakList"
			parameterType="com.example.vacation.mvc.dto.BreakListDTO"
			resultType="com.example.vacation.mvc.vo.SickListVO">
		SELECT
		t.empName,
		DATE_FORMAT(t.empBirth,  '%Y-%m-%d') AS empBirth,
		t.empNo,
		t.position,
		t.department,
		DATE_FORMAT(t.startDate, '%Y-%m-%d') AS startDate,
		DATE_FORMAT(t.endDate,   '%Y-%m-%d') AS endDate,
		t.useDays,
		t.type,
		t.totalDays,
		t.reason,
		t.approval,
		t.status,
		t.regDate,
		t.rejectReason,
		t.vacationType,
		t.specialType,
		t.src
		FROM (
		<include refid="basicTable"/>
		) t
		<include refid="where"/>
		ORDER BY t.regDate DESC
		LIMIT #{pageSize} OFFSET #{pageOffset}
	</select>







</mapper>
