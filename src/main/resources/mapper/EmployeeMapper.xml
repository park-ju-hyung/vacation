<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.vacation.mvc.mapper.EmployeeMapper">
	<!--리스트-->
	<sql id="basicTable">
		SELECT ROW_NUMBER() OVER(order by reg_date) AS seq,
			   empId,
			   empName,
			   DATE_FORMAT(empBirth, '%Y-%m-%d') as empBirth,
			   empNo,
			   position,
			   department,
			   DATE_FORMAT(hiteDate, '%Y-%m-%d') as hireDate,
			   status
		FROM Employee
	</sql>

	<sql id="where">
		WHERE 1=1
		<if test="searchKwd != '' and searchKwd != null">
			<if test="'all'.equals(searchField)">
				AND (
				empName LIKE CONCAT(CONCAT('%', #{searchKwd}), '%')
				OR department LIKE CONCAT(CONCAT('%', #{searchKwd}), '%')
				OR position LIKE CONCAT(CONCAT('%', #{searchKwd}), '%')
				)
			</if>
			<if test="'empName'.equals(searchField)">
				AND empName LIKE CONCAT(CONCAT('%', #{searchKwd}), '%')
			</if>
			<if test="'department'.equals(searchField)">
				AND department LIKE CONCAT(CONCAT('%', #{searchKwd}), '%')
			</if>
			<if test="'position'.equals(searchField)">
				AND position LIKE CONCAT(CONCAT('%', #{searchKwd}), '%')
			</if>
		</if>
	</sql>

	<select id="EmployeeCount" parameterType="com.example.vacation.mvc.dto.EmployeeDTO" resultType="integer">
		SELECT count(*) FROM Employee
		<include refid="where"/>
	</select>

	<select id="Employeelist" parameterType="com.example.vacation.mvc.dto.EmployeeDTO"
			resultType="com.example.vacation.mvc.vo.EmployeeVO">
		<include refid="basicTable"/>
		<include refid="where"/>
		ORDER BY seq DESC
		LIMIT #{pageSize} OFFSET #{pageOffset}
	</select>

	<!--등록-->
	<insert id="insertEmployee" parameterType="com.example.vacation.mvc.dto.EmployeeDTO">
		INSERT INTO Employee ( empId , empName , empBirth, empNo, position, department, hiteDate, email, status
		) VALUES (#{empId}, #{empName}, #{empBirth}, #{empNo}, #{position}, #{department}, #{hireDate}, #{email}, #{status})
	</insert>
</mapper>
